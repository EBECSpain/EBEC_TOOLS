<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<title>Alquiler de herramientas</title>
	<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
		
	<style>
		body{
			font-size:12px;
			font-family:Verdana;
			background:rgb(255,0,0);
		}
		TD{
			font-family:Verdana;
			font-size:10px;
		}
		A, A:LINK, A:VISITED {
			text-decoration:none;
		}
		#contenedor {
			position:relative;
			top:0px;
			left: 0px;
			height: 100%;
		}
		#main{
			position:absolute;
			top:0px;
			left:0px;
			margin-top:150px;
			padding-left:170px;
			text-align:center;
			height: 100%;
			background-position:bottom;
			background-repeat:no-repeat;
		}
	</style>
</head>

<body>

<div id="contenedor" style="width:2000px">
	<img id="imgback" src="fondoMainSpain.png">     
	<div id="main">		
		<p>&nbsp;<br>
		</p><div style="padding-left:0px" align="justify">
		<form name="a">
		<table border="3" align="center">
		<tbody>
		<tr>
      <th width="50" height="30" scope="col">Equipos</th>
      <th scope="col">Herramientas y Materiales </th>
      <th width="100" scope="col">Tiempo restante </th>
      <th width="230" scope="col">Controles</th>      
	  <th width="50" scope="col">Puntos</th>
	  <th width="50" scope="col">Num Veces</th>
	  <th width="500" scope="col">Comment</th>
    </tr>
<script language="javascript" type="text/javascript">
<!--
	var Teams=[
	"1",
	"2",
	"3",
	"4",
	"5",
	"6"
	];
	var nSlots=3;
	var Herr=[
	//{ herramienta, minutos_max, coste_comprar, coste_coger, coste_minuto },
		["Pistola de silicona",30,100,40,5],
		["Sierra metal       ",30,100,40,5],
		["Serrucho madera    ",30,100,40,5],
		["Sierra de arco     ",30,100,40,5],
		["Guantes            ",30,100,40,5],
		["Martillo           ",30,100,40,5],
		["Tijeras            ",30,100,40,5],
		["Cutter             ",30,100,40,5],
		["Metro              ",30,100,40,5],
		["Alargador          ",30,100,40,5],
		["Destornillador     ",30,100,40,5],
	];
	
	var Materiales=[
	//{ material, coste_coger },
		["Liston madera ",10],
		["Liston d4-6mm ",10],
		["Liston d8-10mm",15],
		["Liston d12mm  ",20],
		["Liston 5x10	",10],
		["Varilla metal ",30],
		["Tuerca metal	",10],
		["Panel madera  ",50],
		["Panel corcho	",50],
		["Carton ondas	",20],
		["Cuerda 1m	 	",10],
		["Hembrilla	  	",5],
		["Polea     	",30],
		["Clavos 2ud 	",5],
		["Gomas largas	",2],
		["Gomas cortas	",1],
		["Bridas    	",5],
		["Cola blanca	",15],
		["Cinta american",15],
		["Varios		",1],
	];
	
	var Alq=new Array();
	// Alq [equipo] [slot] [0: herramienta ; 1: tiempo]
	var Points=new Array();
	// Points [equipo] [0:puntos ; 1:numero de alquileres]
	
	Actualizar.count=0;
	
	//Parte activa:
	function Actualizar()
	{
		document.body.style.background="RGB(255,255,255)";
		document.all.imgback.style.opacity=100;
		Actualizar.count+=1;
		var t=(new Date()).getTime()/1000;
		for(i=0;i<Teams.length;i++) //Para cada equipo [i]
		{
			for(j=0;j<nSlots;j++) //Para cada slot [j]
			{

				if(Alq[i][j][0]==-1) //Si no está alquilado se deja "Libre" y el fondo en blanco.

				{
					document.a["t_"+i+"_"+j].value="Libre";
					document.a["t_"+i+"_"+j].style.background="RGB(255,255,255)"; 
				}
				else
				{
				    // actualizar tiempo
					delta=-t+(Alq[i][j][1]+60*Herr[Alq[i][j][0]][1]);
					if(delta<0)
						document.a["t_"+i+"_"+j].value="    - "+parseInt(-delta/60)+":"+(parseInt(-delta%60)<10?"0":"")+parseInt(-delta%60);
					else
						document.a["t_"+i+"_"+j].value=parseInt(delta/60)+":"+(parseInt(delta%60)<10?"0":"")+parseInt(delta%60);
					document.a["m_"+i+"_"+j].value=Alq[i][j][0];
					//colores
					if(delta/60<0)
					{
						document.a["t_"+i+"_"+j].style.background="RGB(255,"+(Actualizar.count%3>1?255:0)+","+(Actualizar.count%3<1?255:0)+")";
						if(Actualizar.count%10<5)
						{
							//document.body.style.background="RGB(255,100,100)"; Parpadea toda la pantalla (con colorines) => Epilepsia onfaya
							//document.all.imgback.style.opacity=0;
							
							document.a["t_"+i+"_"+j].style.background="RGB(255,100,100)"; //Parpadea solo el recuadro del tiempo que se ha pasado. 
																						// => Epilepsia resuelta. El fondo se mantiene normal.
						}
					}
					else if(delta/60<1)
						document.a["t_"+i+"_"+j].style.background="RGB(255,"+(Actualizar.count%6<3?255:0)+","+(Actualizar.count%6<3?255:0)+")";
					else if(delta/60<5)
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,"+(Actualizar.count%8<4?255:0)+")";					
					else if(delta/60<10)
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,100)";		
					else 
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,255)";
				}
			}
			document.a["p_"+i].value=parseInt(Points[i][0]);
			document.a["n_"+i].value=Points[i][1];
		}
		// guardar estado
		localStorage.setItem('Points',Points);
		localStorage.setItem('Alq',Alq);		
	}
	
	//Función del bóton para alquilar herramientas
	function Alquilar(team,slot)
	{
		if(Alq[team][slot][0]==-1)
		{
			var t=(new Date()).getTime()/1000;
			var h=Number(document.a["m_"+team+"_"+slot].value);
			if((h>-1) && (h<Herr.length))
			{
				Alq[team][slot][0]=h;
				Alq[team][slot][1]=t;
			}
			else
				alert("seleccione la herramienta a alquilar");
		}
		else
		{
			alert("Devuelva "+Herr[Alq[team][slot][0]][0]+" antes de alquilar de nuevo");
		}	
	}
	
	//Función del bóton para devolver alquileres
	function Devolver(team,slot)
	{
		if(Alq[team][slot][0]!=-1)
		{
			var t=(new Date()).getTime()/1000;
			Points[team][0]+=(t-Alq[team][slot][1])/60*Herr[Alq[team][slot][0]][4]+Herr[Alq[team][slot][0]][3];
			// Herr[n][3] Precio de alquiler base, Herr[n][4] Precio de alquiler por minuto
			Points[team][1]+=1;
			Alq[team][slot][0]=-1;
			Alq[team][slot][1]=0;
		}
		else
		{
			alert("Nada alquilado");
		}
	}
	
	//Función del bóton para corregir alquileres
	function Corregir(team,slot)
	{
		if(Alq[team][slot][0]!=-1)
		{
			if(confirm("CORREGIR?\nDevolver "+Herr[Alq[team][slot][0]][0]+" \ndel equipo "+Teams[team]+" en la posicion "+slot+" \nsin modificar los puntos?"))
			{
				Alq[team][slot][0]=-1;
				Alq[team][slot][1]=0;
			}
		}
		else
		{alert("Nada alquilado");}
	}
	
	//Función del bóton para comprar herramientas
	function ComprarHer(team,slot)
	{
		var idCuad = "t_" + team + "_" + slot;
		var idDesplegable = "m_" + team + "_" + slot
		var CantidadHer = document.getElementById(idCuad).value; // Cantidad de la herramienta
		var SelecHer = document.getElementById(idDesplegable).value; // Herramienta seleccionada
		
		if (SelecHer == -1)
		{
			alert("Ninguna herramienta para comprar");
		}else{
			Points[team][0]+=Herr[herCompr][2]*CantidadHer;
			// Herr[n][2] Precio de compra
			Points[team][1]+=1*CantidadHer;
		}
	}
	
	//Función del bóton para comprar materiales
	function ComprarMat(team,slot)
	{
		var idCuad = "t_" + team + "_" + slot;
		var idDesplegable = "m_" + team + "_" + slot
		var CantidadMat = document.getElementById(idCuad).value;  // Cantidad del material
		var SelecMat = document.getElementById(idDesplegable).value; // Material seleccionado
		
		if (SelecMat == -1)
		{
			alert("Ningun material para comprar");
		}else{
			Points[team][0]+=Materiales[matCompr][1]*CantidadMat;
			Points[team][1]+=1*CantidadMat;
		}
	}
	
	/////////////////////////////////////
	
	
	//generador HTML
	for(i=0;i<Teams.length;i++)
	{
		Alq[i]=new Array();
		Points[i]=[0,0];
		
		//Codigo del cuadro de Herramientas y Materiales
		
		//Selectores de Alquiler de herramientas
		document.write("<tr><td><div align=\"center\"><font size=\"5\">Equipo "+Teams[i]+"</font></div></td><td><div align=\"center\"><p><b>Alquiler de herramientas</b></p>");
		for(j=0;j<nSlots;j++)
		{
			Alq[i][j]=[-1,0];
			document.write("<select id=\"m_"+i+"_"+j+"\"><option value=\"-1\">-</option>");
			for(k=0;k<Herr.length;k++)
			{
				document.write("<option value=\""+k+"\">"+Herr[k][0]+"("+Herr[k][3]+",+"+Herr[k][4]+"/min)"+"</option>");
			}
			document.write("</select><br>");
		}
		
		//Selectores de Compra de herramientas
		document.write("<p><b>Compra de herramientas</b></p>");
		Alq[i][j]=[-1,0];
		document.write("<select id=\"m_"+i+"_"+j+"\"><option value=\"-1\">-</option>");
		for(k=0;k<Herr.length;k++)
		{
			document.write("<option value=\""+k+"\">"+Herr[k][0]+"("+Herr[k][2]+")"+"</option>");
		}
		document.write("</select><br>");
		
		//Selectores de Compra de materiales
		document.write("<p><b>Compra de materiales</b></p><select id=\"m_"+i+"_"+j+"\"><option value=\"-1\">-</option>");
		for(k=0;k<Materiales.length;k++)
		{
			document.write("<option value=\""+k+"\">"+Materiales[k][0]+"("+Materiales[k][1]+")"+"</option>");
		}
		document.write("</select><br><br>");
		
		document.write("</div></td><td><div align=\"center\"><br><br><br>");
		
		
		
		//Codigo del cuadro de Tiempo restante
		
		//Tiempo restante de Alquiler de Herramientas
		for(j=0;j<nSlots;j++)
		{
			document.write("<input id=\"t_"+i+"_"+j+"\" type=\"text\" readonly value=\"0\" style=\"width:100px;\"><br>");			
		}
		
		//Cantidad de herramientas a comprar
		document.write("<p><b>Cantidad</b></p><input id=\"t_"+i+"_"+j+"\" type=\"text\" value=\"0\" style=\"width:100px;text-align:center;\"><br>");
		
		//Cantidad de materiales a comprar
		document.write("<p><b>Cantidad</b></p><input id=\"t_"+i+"_"+j+"\" type=\"text\" value=\"0\" style=\"width:100px;text-align:center;\"><br>");
		document.write("<br><br></div></td><td><br>");
		
		
		
		//Codigo del cuadro de Controles
		
		//Botones de Alquilar, Devolver y Corregir de Alquiler de Herramientas
		for(j=0;j<nSlots;j++)
		{
			document.write("<div align=\"center\">");
			document.write("<input type=\"button\" value=\"Alquilar\" onclick=\"Alquilar("+i+","+j+")\" >");		
			document.write("<input type=\"button\" value=\"Devolver\" onclick=\"Devolver("+i+","+j+")\" >");			
			document.write("<input type=\"button\" value=\"Corregir\" onclick=\"Corregir("+i+","+j+")\" ></div>");			
		}
		
		//Boton de comprar herramientas, falta crear la funcion asociada
		document.write("<br><br><div align=\"center\"><input type=\"button\" value=\"Comprar\" onclick=\"ComprarHer("+i+","+j+")\" ></div>");
		
		//Boton de comprar materiales, falta crear la funcion asociada
		document.write("<br><br><div align=\"center\"><input type=\"button\" value=\"Comprar\" onclick=\"ComprarMat("+i+","+j+")\" ></div>");
		
		document.write("</td><td><input id=\"p_"+i+"\" type=\"text\" readonly value=\"0\" style=\"width:50px;\"></td>");			
		document.write("<td><input id=\"n_"+i+"\" type=\"text\" readonly value=\"0\" style=\"width:50px;\"></td><td><textarea rows=\"4\" style=\"width:500px;\"></textarea></td>");
	}
	
	//CARGA de datos
	if (localStorage.getItem('Points'))
		if(confirm("Cargar datos guardados?")||confirm("Va a SOBREESCRIBIR LOS DATOS ANTERIORES!\nCargar datos guardados?"))
		{
			foo=localStorage.getItem('Points').split(",");
			for(i=0;i<foo.length;i+=2)
			{
				Points[i/2][0]=Number(foo[i]);
				Points[i/2][1]=Number(foo[i+1]);				
			}
			foo=localStorage.getItem('Alq').split(",");			
			for(i=0;i<foo.length;i+=nSlots*2)
			{
				for(j=0;j<nSlots;j++)
				{
					Alq[i/(nSlots*2)][j][0]=Number(foo[i+2*j]);
					Alq[i/(nSlots*2)][j][1]=Number(foo[i+2*j+1]);
				}					
			}
		}
	
	//Arranque
	self.setInterval(function(){Actualizar()},200);
//-->
</script>
  </tbody>	
  </table>
 </form>
</body>
</html>

