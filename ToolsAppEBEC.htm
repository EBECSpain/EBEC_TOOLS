<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

	<link rel="stylesheet" type="text/css" href="style.css">

<title>Alquiler de herramientas</title>
</head>

<body>

<div id="contenedor" style="width:2000px">
	<img id="imgback" src="fondoMainSpain.png">     
	<div id="main">		
		<p>&nbsp;<br>
		</p><div style="padding-left:0px" align="justify">
		<form name="a">
		<table border="3" align="center">
		<tbody>
		<tr>
      <th width="50" height="30" scope="col">Equipo</th>
      <th scope="col">Herramientas alquiladas </th>
      <th width="100" scope="col">Tiempo restante </th>
      <th width="190" scope="col">Controles</th>      
	  <th width="50" scope="col">Puntos</th>
	  <th width="50" scope="col">Num Veces</th>
	  <th width="500" scope="col">Comment</th>
    </tr>
<script language="javascript" type="text/javascript">
<!--
	var Teams=[
	"CarlosIII",
	"MadridUPM",
	"Valencia",
	"Valladolid",
	"Las Palmas",
	"Barcelona"
	];
	var nSlots=3;
	var Herr=[
	//{herramienta,minutos_max,coste_coger,coste_minuto},
		["Pistola de silicona",30,1000,1],
		["Sierra metal       ",30,1000,1],
		["Serrucho madera    ",30,1000,1],
		["Soldador de estaño ",30,1000,1],
		["Barrena            ",30,1000,1],
		["Segueta            ",30,1000,1],
		["Lima               ",30,1000,1],
		["Sierra de Calar    ",30,1000,1],
		["Multímetro         ",30,1000,1],
		["Martillo           ",30,1000,1],
		["Destornillador     ",30,1000,1]
	];
	
	var Alq=new Array();
	var Points=new Array();
	
	Actualizar.count=0;
	
	function Actualizar()
	{
		document.body.style.background="RGB(255,255,255)";
		document.all.imgback.style.opacity=100;
		Actualizar.count+=1;
		var t=(new Date()).getTime()/1000;
		for(i=0;i<Teams.length;i++)
		{
			for(j=0;j<nSlots;j++)
			{
				if(Alq[i][j][0]==-1)
				{
					document.a["t_"+i+"_"+j].value="Libre";
					document.a["t_"+i+"_"+j].style.background="RGB(255,255,255)";
				}
				else
				{
					delta=-t+(Alq[i][j][1]+60*Herr[Alq[i][j][0]][1]);
					if(delta<0)
						document.a["t_"+i+"_"+j].value="    - "+parseInt(-delta/60)+":"+(parseInt(-delta%60)<10?"0":"")+parseInt(-delta%60);
					else
						document.a["t_"+i+"_"+j].value=parseInt(delta/60)+":"+(parseInt(delta%60)<10?"0":"")+parseInt(delta%60);
					document.a["m_"+i+"_"+j].value=Alq[i][j][0];
					if(delta/60<0)
					{
						document.a["t_"+i+"_"+j].style.background="RGB(255,"+(Actualizar.count%3>1?255:0)+","+(Actualizar.count%3<1?255:0)+")";
						if(Actualizar.count%10<5)
						{
							document.body.style.background="RGB(255,100,100)";
							document.all.imgback.style.opacity=0;
						}
					}
					else if(delta/60<1)
						document.a["t_"+i+"_"+j].style.background="RGB(255,"+(Actualizar.count%6<3?255:0)+","+(Actualizar.count%6<3?255:0)+")";
					else if(delta/60<5)
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,"+(Actualizar.count%8<4?255:0)+")";					
					else if(delta/60<10)
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,100)";		
					else 
						document.a["t_"+i+"_"+j].style.background="RGB(255,255,255)";
				}
			}
			document.a["p_"+i].value=parseInt(Points[i][0]);
			document.a["n_"+i].value=Points[i][1];
		}
		localStorage.setItem('Points',Points);
		localStorage.setItem('Alq',Alq);		
	}
	
	function Alquilar(team,slot)
	{
		if(Alq[team][slot][0]==-1)
		{
			var t=(new Date()).getTime()/1000;
			var h=Number(document.a["m_"+team+"_"+slot].value);
			if((h>-1) && (h<Herr.length))
			{
				Alq[team][slot][0]=h;
				Alq[team][slot][1]=t;
			}
			else
				alert("seleccione la herramienta a alquilar");
		}
		else
		{
			alert("Devuelva "+Herr[Alq[team][slot][0]][0]+" antes de alquilar de nuevo");
		}	
	}
	
	function Devolver(team,slot)
	{
		if(Alq[team][slot][0]!=-1)
		{
			var t=(new Date()).getTime()/1000;
			Points[team][0]+=(t-Alq[team][slot][1])/60*Herr[Alq[team][slot][0]][3]+Herr[Alq[team][slot][0]][2];
			Points[team][1]+=1;
			Alq[team][slot][0]=-1;
			Alq[team][slot][1]=0;
		}
		else
		{alert("Nada alquilado");}
	}

	function Corregir(team,slot)
	{
		if(Alq[team][slot][0]!=-1)
		{
			if(confirm("CORREGIR?\nDevolver "+Herr[Alq[team][slot][0]][0]+" \ndel equipo "+Teams[team]+" en la posición "+slot+" \nsin modificar los puntos?"))
			{
				Alq[team][slot][0]=-1;
				Alq[team][slot][1]=0;
			}
		}
		else
		{alert("Nada alquilado");}
	}
	
	for(i=0;i<Teams.length;i++)
	{
		Alq[i]=new Array();
		Points[i]=[0,0];
		document.write("<tr><td><div align=\"center\"><font size=\"5\">Eq "+Teams[i]+"</font></div></td><td><div align=\"center\">");
		for(j=0;j<nSlots;j++)
		{
			Alq[i][j]=[-1,0];
			document.write("<select id=\"m_"+i+"_"+j+"\"><option value=\"-1\">-</option>");
			for(k=0;k<Herr.length;k++)
			{
				document.write("<option value=\""+k+"\">"+Herr[k][0]+"</option>");
			}
			document.write("</select><br>");
		}
		document.write("</div></td><td><div align=\"center\">");
		for(j=0;j<nSlots;j++)
		{
			document.write("<input id=\"t_"+i+"_"+j+"\" type=\"text\" readonly value=\"0\" style=\"width:100px;\"><br>");			
		}
		document.write("</div></td><td>");
		for(j=0;j<nSlots;j++)
		{
			document.write("<div align=\"center\">");
			document.write("<input type=\"button\" value=\"Alquilar\" onclick=\"Alquilar("+i+","+j+")\" >");		
			document.write("<input type=\"button\" value=\"Devolver\" onclick=\"Devolver("+i+","+j+")\" >");			
			document.write("<input type=\"button\" value=\"Undo\" onclick=\"Corregir("+i+","+j+")\" ></div>");			
		}
		document.write("</td><td><input id=\"p_"+i+"\" type=\"text\" readonly value=\"0\" style=\"width:50px;\"></td>");			
		document.write("<td><input id=\"n_"+i+"\" type=\"text\" readonly value=\"0\" style=\"width:50px;\"></td><td><textarea rows=\"4\" style=\"width:500px;\"></textarea></td>");
	}
	if (localStorage.getItem('Points'))
		if(confirm("Cargar datos guardados?")||confirm("Va a SOBREESCRIBIR LOS DATOS ANTERIORES!\nCargar datos guardados?"))
		{
			foo=localStorage.getItem('Points').split(",");
			for(i=0;i<foo.length;i+=2)
			{
				Points[i/2][0]=Number(foo[i]);
				Points[i/2][1]=Number(foo[i+1]);				
			}
			foo=localStorage.getItem('Alq').split(",");			
			for(i=0;i<foo.length;i+=nSlots*2)
			{
				for(j=0;j<nSlots;j++)
				{
					Alq[i/(nSlots*2)][j][0]=Number(foo[i+2*j]);
					Alq[i/(nSlots*2)][j][1]=Number(foo[i+2*j+1]);
				}					
			}
		}
	
	self.setInterval(function(){Actualizar()},200);
//-->
</script>
  </tbody>	
  </table>
 </form>
</body>
</html>

